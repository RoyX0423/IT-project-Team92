<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Account</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/vue@2"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="togglePassword.js"></script>
    <link rel="stylesheet" href="icon/iconfont.css">
    <link rel="stylesheet" href="icon\email&code\iconfont.css">
</head>

<body>
    <div class="background">
        <h1>Create Account</h1>
    </div>

    <div class="input-box4">
        <a href="index.html">Already have an account?</a>
        <a href="needhelp.html" class="needhelp2">Need help?</a>
    </div>

    <form id="registerForm">
        <div class="input-box1">
            <i class="el-icon-user"></i>
            <input type="text" class="username" name="username" placeholder="User Name">
        </div>

        <div class="input-box1">
            <span class="iconfont">&#xebca;</span>
            <input type="text" class="username email" name="email" placeholder="Email Address">
        </div>

        <div class="input-box">
            <i class="el-icon-lock"></i>
            <input type="password" class="password" name="password" placeholder="Password" id="password"
                oninput="checkPasswordStrength()">
            <i class="iconfont icon-view-2" id="togglePassword" style="cursor: pointer;"></i>
            <div id="password-strength"></div>
        </div>

        <script>
            function checkPasswordStrength() {
                const password = document.getElementById('password').value;
                const strengthBar = document.getElementById('password-strength');
                let strength = 0;

                if (password.length >= 8) strength++;
                if (/[A-Z]/.test(password)) strength++;
                if (/[a-z]/.test(password)) strength++;
                if (/[0-9]/.test(password)) strength++;
                if (/[\W_]/.test(password)) strength++;

                const messages = ["Very Weak", "Weak", "Moderate", "Strong", "Very Strong"];
                strengthBar.textContent = `Password strength: ${messages[strength]}`;
                strengthBar.style.color = ['#ff4d4f', '#ff7a45', '#ffa940', '#52c41a', '#237804'][strength];
            }
        </script>

        <div class="input-box">
            <i class="el-icon-lock"></i>
            <input type="password" class="password" name="confirmPassword" placeholder="Confirm Password"
                id="confirmPassword" oninput="checkPasswordMatch()">
            <i class="iconfont icon-view-2" id="toggleConfirmPassword" style="cursor: pointer;"></i>
            <div id="password-match"></div>
        </div>

        <script>
            function checkPasswordMatch() {
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                const matchMessage = document.getElementById('password-match');

                // 修正条件
                if (password.length > 0 && confirmPassword.length > 0) {
                    if (password === confirmPassword) {
                        matchMessage.textContent = "Passwords match.";
                        matchMessage.style.color = "#52c41a";
                    } else {
                        matchMessage.textContent = "Passwords do not match.";
                        matchMessage.style.color = "#ff4d4f";
                    }
                } else {
                    matchMessage.textContent = "";
                }
            }
            // 确保匹配检查正确绑定到输入事件
            document.getElementById('password').addEventListener('input', checkPasswordMatch);
            document.getElementById('confirmPassword').addEventListener('input', checkPasswordMatch);
        </script>

        <div class="input-box">
            <input type="button" class="login" name="login" value="NEXT">
        </div>
    </form>

    <div class="input-box2">
        <input type="checkbox" class="checkbox" name="checkbox" id="agreeTerms">
        <label for="remember">By creating an account, you agree to the <span><a href="#">Term of Use</a></span> and
            <span><a href="PrivacyPolicy.html">Privacy Policy</a></span>.</label>
    </div>

    <script>
        document.querySelector('.login').addEventListener('click', function () {
            const form = document.getElementById('registerForm');
            const formData = new FormData(form);
            const username = formData.get('username');
            const email = formData.get('email');
            const password = formData.get('password');
            const confirmPassword = formData.get('confirmPassword');
            const agreeTerms = document.getElementById('agreeTerms').checked;

            // 验证是否同意条款
            if (!agreeTerms) {
                alert('You must agree to the Terms of Use and Privacy Policy to create an account.');
                return;
            }

            // 验证密码是否匹配
            if (password !== confirmPassword) {
                alert('Passwords do not match.');
                return;
            }

            // 验证成功，发送数据到后端
            fetch('http://localhost:8000/users/register', {
                method: 'POST',
                body: JSON.stringify({ username, email, password }),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    alert('Account created successfully!');
                    window.location.href = 'index.html'; // 注册成功后跳转
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('There was an error creating your account.');
                });
        });
    </script>

</body>

</html>
